{"version":3,"sources":["../../../src/commands/eject/Eject.ts"],"names":["ejectAsync","projectRoot","options","exp","pkg","ensureConfigAsync","tempDir","temporary","directory","hasNewProjectFiles","needsPodInstall","createNativeProjectsFromTemplateAsync","isSyncing","shouldInstall","install","packageManager","CreateApp","resolvePackageManager","npm","yarn","installNodeDependenciesAsync","clean","configureIOSStepAsync","configureAndroidStepAsync","podsInstalled","installCocoaPodsAsync","warnIfDependenciesRequireAdditionalSetupAsync","log","newLine","nested","chalk","bold","WarningAggregator","hasWarningsIOS","hasWarningsAndroid","installCmd","hasOwnProperty","dim","fallback","text","applyingIOSConfigStep","logNewSection","ConfigWarningAggregator","stopAndPersist","symbol","red","succeed","cleanJsDepsStep","fs","remove","installJsDepsStep","fail","process","exit","applyingAndroidConfigStep","copyPathsFromTemplate","templatePath","paths","copiedPaths","skippedPaths","targetPath","projectPath","path","join","existsSync","push","copySync","config","dynamicConfigPath","staticConfigPath","JsonFile","writeAsync","expo","json5","error","console","message","entryPoint","createFileHash","contents","crypto","createHash","update","digest","writeMetroConfig","updatingMetroConfigStep","sourceConfigPath","targetConfigPath","targetConfigPathExists","readFileSync","targetContents","Error","stop","clear","metro","e","validateBareTemplateExistsAsync","sdkVersion","sdkMajorVersionNumber","semver","major","templateSpec","pacote","manifest","code","updatePackageJSONAsync","defaultDependencies","defaultDevDependencies","dependencies","devDependencies","read","createDependenciesMap","updatingPackageJsonStep","scripts","start","ios","android","combinedDependencies","requiredDependencies","dependenciesKey","combinedDevDependencies","hasNewDependencies","hashForDependencyMap","hasNewDevDependencies","removedPkgMain","shouldDeleteMainField","main","writeFile","resolve","JSON","stringify","isPkgMainExpoAppEntry","startsWith","normalizeDependencyMap","deps","Object","keys","map","dependency","sort","depsList","depsString","cloneNativeDirectoriesAsync","creatingNativeProjectStep","targetPaths","Exp","extractTemplateAppAsync","results","GitIgnore","mergeGitIgnorePaths","length","didMerge","didClear","yellow","depsResults","includes","outputMap","key","value","pkgsWithExtraSetup","packagesToWarn","filter","pkgName","warnAdditionalSetupStep","plural","forEach","stripDashes","s","replace","input"],"mappings":"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","sourcesContent":["import {\n  WarningAggregator as ConfigWarningAggregator,\n  ExpoConfig,\n  getConfig,\n  PackageJSONConfig,\n  projectHasModule,\n  WarningAggregator,\n} from '@expo/config';\nimport JsonFile, { JSONObject } from '@expo/json-file';\nimport { Exp } from '@expo/xdl';\nimport chalk from 'chalk';\nimport crypto from 'crypto';\nimport fs from 'fs-extra';\nimport npmPackageArg from 'npm-package-arg';\nimport pacote from 'pacote';\nimport path from 'path';\nimport semver from 'semver';\nimport temporary from 'tempy';\nimport terminalLink from 'terminal-link';\n\nimport log from '../../log';\nimport configureAndroidProjectAsync from '../apply/configureAndroidProjectAsync';\nimport configureIOSProjectAsync from '../apply/configureIOSProjectAsync';\nimport * as CreateApp from '../utils/CreateApp';\nimport * as GitIgnore from '../utils/GitIgnore';\nimport { usesOldExpoUpdatesAsync } from '../utils/ProjectUtils';\nimport { learnMore } from '../utils/TerminalLink';\nimport { logConfigWarningsAndroid, logConfigWarningsIOS } from '../utils/logConfigWarnings';\nimport maybeBailOnGitStatusAsync from '../utils/maybeBailOnGitStatusAsync';\nimport { getOrPromptForBundleIdentifier, getOrPromptForPackage } from './ConfigValidation';\n\ntype DependenciesMap = { [key: string]: string | number };\n\nexport type EjectAsyncOptions = {\n  verbose?: boolean;\n  force?: boolean;\n  install?: boolean;\n  packageManager?: 'npm' | 'yarn';\n};\n\n/**\n * Entry point into the eject process, delegates to other helpers to perform various steps.\n *\n * 1. Verify git is clean\n * 2. Create native projects (ios, android)\n * 3. Install node modules\n * 4. Apply config to native projects\n * 5. Install CocoaPods\n * 6. Log project info\n */\nexport async function ejectAsync(projectRoot: string, options?: EjectAsyncOptions): Promise<void> {\n  if (await maybeBailOnGitStatusAsync()) return;\n\n  const { exp, pkg } = await ensureConfigAsync(projectRoot);\n  const tempDir = temporary.directory();\n\n  const { hasNewProjectFiles, needsPodInstall } = await createNativeProjectsFromTemplateAsync(\n    projectRoot,\n    exp,\n    pkg,\n    tempDir\n  );\n  // Set this to true when we can detect that the user is running eject to sync new changes rather than ejecting to bare.\n  // This will be used to prevent the node modules from being nuked every time.\n  const isSyncing = !hasNewProjectFiles;\n\n  // Install node modules\n  const shouldInstall = options?.install !== false;\n\n  const packageManager = CreateApp.resolvePackageManager({\n    install: shouldInstall,\n    npm: options?.packageManager === 'npm',\n    yarn: options?.packageManager === 'yarn',\n  });\n\n  if (shouldInstall) {\n    await installNodeDependenciesAsync(projectRoot, packageManager, { clean: !isSyncing });\n  }\n\n  // Apply Expo config to native projects\n  await configureIOSStepAsync(projectRoot);\n  await configureAndroidStepAsync(projectRoot);\n\n  // Install CocoaPods\n  let podsInstalled: boolean = false;\n  // err towards running pod install less because it's slow and users can easily run npx pod-install afterwards.\n  if (shouldInstall && needsPodInstall) {\n    podsInstalled = await CreateApp.installCocoaPodsAsync(projectRoot);\n  }\n\n  await warnIfDependenciesRequireAdditionalSetupAsync(pkg, options);\n\n  log.newLine();\n  log.nested(`‚û°Ô∏è  ${chalk.bold('Next steps')}`);\n\n  if (WarningAggregator.hasWarningsIOS() || WarningAggregator.hasWarningsAndroid()) {\n    log.nested(\n      `- üëÜ Review the logs above and look for any warnings (‚ö†Ô∏è ) that might need follow-up.`\n    );\n  }\n\n  // Log a warning about needing to install node modules\n  if (options?.install === false) {\n    const installCmd = packageManager === 'npm' ? 'npm install' : 'yarn';\n    log.nested(`- ‚ö†Ô∏è  Install node modules: ${log.chalk.bold(installCmd)}`);\n  }\n  if (!podsInstalled) {\n    log.nested(\n      `- üç´ When CocoaPods is installed, initialize the project workspace: ${chalk.bold(\n        'npx pod-install'\n      )}`\n    );\n  }\n  log.nested(\n    `- üí° You may want to run ${chalk.bold(\n      'npx @react-native-community/cli doctor'\n    )} to help install any tools that your app may need to run your native projects.`\n  );\n  log.nested(\n    `- üîë Download your Android keystore (if you're not sure if you need to, just run the command and see): ${chalk.bold(\n      'expo fetch:android:keystore'\n    )}`\n  );\n\n  if (exp.hasOwnProperty('assetBundlePatterns')) {\n    log.nested(\n      `- üìÅ The property ${chalk.bold(\n        `assetBundlePatterns`\n      )} does not have the same effect in the bare workflow. ${log.chalk.dim(\n        learnMore('https://docs.expo.io/bare/updating-your-app/#embedding-assets')\n      )}`\n    );\n  }\n\n  if (await usesOldExpoUpdatesAsync(projectRoot)) {\n    log.nested(\n      `- üöÄ ${\n        (terminalLink(\n          'expo-updates',\n          'https://github.com/expo/expo/blob/master/packages/expo-updates/README.md'\n        ),\n        {\n          fallback: (text: string) => text,\n        })\n      } has been configured in your project. Before you do a release build, make sure you run ${chalk.bold(\n        'expo publish'\n      )}. ${log.chalk.dim(learnMore('https://expo.fyi/release-builds-with-expo-updates'))}`\n    );\n  }\n\n  if (hasNewProjectFiles) {\n    log.newLine();\n    log.nested(`‚òëÔ∏è  ${chalk.bold('When you are ready to run your project')}`);\n    log.nested(\n      'To compile and run your project in development, execute one of the following commands:'\n    );\n\n    log.nested(`- ${chalk.bold(packageManager === 'npm' ? 'npm run ios' : 'yarn ios')}`);\n    log.nested(`- ${chalk.bold(packageManager === 'npm' ? 'npm run android' : 'yarn android')}`);\n    log.nested(`- ${chalk.bold(packageManager === 'npm' ? 'npm run web' : 'yarn web')}`);\n  }\n}\n\nasync function configureIOSStepAsync(projectRoot: string) {\n  const applyingIOSConfigStep = CreateApp.logNewSection('iOS config syncing');\n  await configureIOSProjectAsync(projectRoot);\n  if (ConfigWarningAggregator.hasWarningsIOS()) {\n    applyingIOSConfigStep.stopAndPersist({\n      symbol: '‚ö†Ô∏è ',\n      text: chalk.red('iOS config synced with warnings that should be fixed:'),\n    });\n    logConfigWarningsIOS();\n  } else {\n    applyingIOSConfigStep.succeed('iOS config synced');\n  }\n}\n\n/**\n * Wraps PackageManager to install node modules and adds CLI logs.\n *\n * @param projectRoot\n */\nasync function installNodeDependenciesAsync(\n  projectRoot: string,\n  packageManager: 'yarn' | 'npm',\n  { clean = true }: { clean: boolean }\n) {\n  if (clean) {\n    // This step can take a couple seconds, if the installation logs are enabled (with EXPO_DEBUG) then it\n    // ends up looking odd to see \"Installing JavaScript dependencies\" for ~5 seconds before the logs start showing up.\n    const cleanJsDepsStep = CreateApp.logNewSection('Cleaning JavaScript dependencies.');\n    // nuke the node modules\n    // TODO: this is substantially slower, we should find a better alternative to ensuring the modules are installed.\n    await fs.remove('node_modules');\n    cleanJsDepsStep.succeed('Cleaned JavaScript dependencies.');\n  }\n\n  const installJsDepsStep = CreateApp.logNewSection('Installing JavaScript dependencies.');\n\n  try {\n    await CreateApp.installNodeDependenciesAsync(projectRoot, packageManager);\n    installJsDepsStep.succeed('Installed JavaScript dependencies.');\n  } catch {\n    installJsDepsStep.fail(\n      chalk.red(\n        `Something went wrong installing JavaScript dependencies, check your ${packageManager} logfile or run ${chalk.bold(\n          `${packageManager} install`\n        )} again manually.`\n      )\n    );\n    // TODO: actually show the error message from the package manager! :O\n    process.exit(1);\n  }\n}\n\nasync function configureAndroidStepAsync(projectRoot: string) {\n  const applyingAndroidConfigStep = CreateApp.logNewSection('Android config syncing');\n  await configureAndroidProjectAsync(projectRoot);\n  if (ConfigWarningAggregator.hasWarningsAndroid()) {\n    applyingAndroidConfigStep.stopAndPersist({\n      symbol: '‚ö†Ô∏è ',\n      text: chalk.red('Android config synced with warnings that should be fixed:'),\n    });\n    logConfigWarningsAndroid();\n  } else {\n    applyingAndroidConfigStep.succeed('Android config synced');\n  }\n}\n\nfunction copyPathsFromTemplate(\n  projectRoot: string,\n  templatePath: string,\n  paths: string[]\n): [string[], string[]] {\n  const copiedPaths = [];\n  const skippedPaths = [];\n  for (const targetPath of paths) {\n    const projectPath = path.join(projectRoot, targetPath);\n    if (!fs.existsSync(projectPath)) {\n      copiedPaths.push(targetPath);\n      fs.copySync(path.join(templatePath, targetPath), projectPath);\n    } else {\n      skippedPaths.push(targetPath);\n    }\n  }\n  return [copiedPaths, skippedPaths];\n}\n\nasync function ensureConfigAsync(\n  projectRoot: string\n): Promise<{ exp: ExpoConfig; pkg: PackageJSONConfig }> {\n  // We need the SDK version to proceed\n\n  let exp: ExpoConfig;\n  let pkg: PackageJSONConfig;\n  try {\n    const config = getConfig(projectRoot);\n    exp = config.exp;\n    pkg = config.pkg;\n\n    // If no config exists in the file system then we should generate one so the process doesn't fail.\n    if (!config.dynamicConfigPath && !config.staticConfigPath) {\n      // Don't check for a custom config path because the process should fail if a custom file doesn't exist.\n      // Write the generated config.\n      // writeConfigJsonAsync(projectRoot, config.exp);\n      await JsonFile.writeAsync(\n        // TODO: Write to app.config.json because it's easier to convert to a js config file.\n        path.join(projectRoot, 'app.json'),\n        { expo: (config.exp as unknown) as JSONObject },\n        { json5: false }\n      );\n    }\n  } catch (error) {\n    // TODO(Bacon): Currently this is already handled in the command\n    console.log();\n    console.log(chalk.red(error.message));\n    console.log();\n    process.exit(1);\n  }\n\n  // Prompt for the Android package first because it's more strict than the bundle identifier\n  // this means you'll have a better chance at matching the bundle identifier with the package name.\n  await getOrPromptForPackage(projectRoot);\n  await getOrPromptForBundleIdentifier(projectRoot);\n\n  if (exp.entryPoint) {\n    delete exp.entryPoint;\n    log(`- expo.entryPoint is not needed and has been removed.`);\n  }\n\n  return { exp, pkg };\n}\n\nfunction createFileHash(contents: string): string {\n  // this doesn't need to be secure, the shorter the better.\n  return crypto.createHash('sha1').update(contents).digest('hex');\n}\n\nfunction writeMetroConfig({\n  projectRoot,\n  pkg,\n  tempDir,\n}: {\n  projectRoot: string;\n  pkg: PackageJSONConfig;\n  tempDir: string;\n}) {\n  /**\n   * Add metro config, or warn if metro config already exists. The developer will need to add the\n   * hashAssetFiles plugin manually.\n   */\n\n  const updatingMetroConfigStep = CreateApp.logNewSection('Adding Metro bundler configuration');\n\n  try {\n    const sourceConfigPath = path.join(tempDir, 'metro.config.js');\n    const targetConfigPath = path.join(projectRoot, 'metro.config.js');\n    const targetConfigPathExists = fs.existsSync(targetConfigPath);\n    if (targetConfigPathExists) {\n      // Prevent re-runs from throwing an error if the metro config hasn't been modified.\n      const contents = createFileHash(fs.readFileSync(targetConfigPath, 'utf8'));\n      const targetContents = createFileHash(fs.readFileSync(sourceConfigPath, 'utf8'));\n      if (contents !== targetContents) {\n        throw new Error('Existing Metro configuration found; not overwriting.');\n      } else {\n        // Nothing to change, hide the step and exit.\n        updatingMetroConfigStep.stop();\n        updatingMetroConfigStep.clear();\n        return;\n      }\n    } else if (\n      fs.existsSync(path.join(projectRoot, 'metro.config.json')) ||\n      pkg.metro ||\n      fs.existsSync(path.join(projectRoot, 'rn-cli.config.js'))\n    ) {\n      throw new Error('Existing Metro configuration found; not overwriting.');\n    }\n\n    fs.copySync(sourceConfigPath, targetConfigPath);\n    updatingMetroConfigStep.succeed('Added Metro bundler configuration.');\n  } catch (e) {\n    updatingMetroConfigStep.stopAndPersist({\n      symbol: '‚ö†Ô∏è ',\n      text: chalk.red('Metro bundler configuration not applied:'),\n    });\n    log.nested(`- ${e.message}`);\n    log.nested(\n      `- You will need to add the ${chalk.bold(\n        'hashAssetFiles'\n      )} plugin to your Metro configuration. ${log.chalk.dim(\n        learnMore('https://docs.expo.io/bare/installing-updates/')\n      )}`\n    );\n    log.newLine();\n  }\n}\n\nasync function validateBareTemplateExistsAsync(sdkVersion: string): Promise<npmPackageArg.Result> {\n  // Validate that the template exists\n  const sdkMajorVersionNumber = semver.major(sdkVersion);\n  const templateSpec = npmPackageArg(`expo-template-bare-minimum@sdk-${sdkMajorVersionNumber}`);\n  try {\n    await pacote.manifest(templateSpec);\n  } catch (e) {\n    if (e.code === 'E404') {\n      throw new Error(\n        `Unable to eject because an eject template for SDK ${sdkMajorVersionNumber} was not found.`\n      );\n    } else {\n      throw e;\n    }\n  }\n\n  return templateSpec;\n}\n\ntype DependenciesModificationResults = {\n  hasNewDependencies: boolean;\n  hasNewDevDependencies: boolean;\n};\n\nasync function updatePackageJSONAsync({\n  projectRoot,\n  tempDir,\n  pkg,\n}: {\n  projectRoot: string;\n  tempDir: string;\n  pkg: PackageJSONConfig;\n}): Promise<DependenciesModificationResults> {\n  let defaultDependencies: any = {};\n  let defaultDevDependencies: any = {};\n  const { dependencies, devDependencies } = JsonFile.read(path.join(tempDir, 'package.json'));\n  defaultDependencies = createDependenciesMap(dependencies);\n  defaultDevDependencies = createDependenciesMap(devDependencies);\n  /**\n   * Update package.json scripts - `npm start` should default to `react-native\n   * start` rather than `expo start` after ejecting, for example.\n   */\n  // NOTE(brentvatne): Removing spaces between steps for now, add back when\n  // there is some additional context for steps\n  const updatingPackageJsonStep = CreateApp.logNewSection(\n    'Updating your package.json scripts, dependencies, and main file'\n  );\n  if (!pkg.scripts) {\n    pkg.scripts = {};\n  }\n  pkg.scripts.start = 'react-native start';\n  pkg.scripts.ios = 'react-native run-ios';\n  pkg.scripts.android = 'react-native run-android';\n\n  /**\n   * Update package.json dependencies by combining the dependencies in the project we are ejecting\n   * with the dependencies in the template project. Does the same for devDependencies.\n   *\n   * - The template may have some dependencies beyond react/react-native/react-native-unimodules,\n   *   for example RNGH and Reanimated. We should prefer the version that is already being used\n   *   in the project for those, but swap the react/react-native/react-native-unimodules versions\n   *   with the ones in the template.\n   * - The same applies to expo-updates -- since some native project configuration may depend on the\n   *   version, we should always use the version of expo-updates in the template.\n   */\n\n  const combinedDependencies: DependenciesMap = createDependenciesMap({\n    ...defaultDependencies,\n    ...pkg.dependencies,\n  });\n\n  const requiredDependencies = ['react', 'react-native-unimodules', 'react-native', 'expo-updates'];\n\n  for (const dependenciesKey of requiredDependencies) {\n    combinedDependencies[dependenciesKey] = defaultDependencies[dependenciesKey];\n  }\n  const combinedDevDependencies: DependenciesMap = createDependenciesMap({\n    ...defaultDevDependencies,\n    ...pkg.devDependencies,\n  });\n\n  // Only change the dependencies if the normalized hash changes, this helps to reduce meaningless changes.\n  const hasNewDependencies =\n    hashForDependencyMap(pkg.dependencies) !== hashForDependencyMap(combinedDependencies);\n  const hasNewDevDependencies =\n    hashForDependencyMap(pkg.devDependencies) !== hashForDependencyMap(combinedDevDependencies);\n  // Save the dependencies\n  if (hasNewDependencies) {\n    pkg.dependencies = combinedDependencies;\n  }\n  if (hasNewDevDependencies) {\n    pkg.devDependencies = combinedDevDependencies;\n  }\n\n  /**\n   * Add new app entry points\n   */\n  let removedPkgMain;\n  // Check that the pkg.main doesn't match:\n  // - ./node_modules/expo/AppEntry\n  // - ./node_modules/expo/AppEntry.js\n  // - node_modules/expo/AppEntry.js\n  // - expo/AppEntry.js\n  // - expo/AppEntry\n  if (shouldDeleteMainField(pkg.main)) {\n    // Save the custom\n    removedPkgMain = pkg.main;\n    delete pkg.main;\n  }\n  await fs.writeFile(path.resolve(projectRoot, 'package.json'), JSON.stringify(pkg, null, 2));\n\n  updatingPackageJsonStep.succeed(\n    'Updated package.json and added index.js entry point for iOS and Android.'\n  );\n  if (removedPkgMain) {\n    log(\n      `- Removed ${chalk.bold(\n        `\"main\": \"${removedPkgMain}\"`\n      )} from package.json because we recommend using index.js as main instead.`\n    );\n    log.newLine();\n  }\n\n  return {\n    hasNewDependencies,\n    hasNewDevDependencies,\n  };\n}\n\nexport function shouldDeleteMainField(main?: any): boolean {\n  if (!main || !isPkgMainExpoAppEntry(main)) {\n    return false;\n  }\n\n  return !main?.startsWith('index.');\n}\n\nfunction normalizeDependencyMap(deps: DependenciesMap): string[] {\n  return Object.keys(deps)\n    .map(dependency => `${dependency}@${deps[dependency]}`)\n    .sort();\n}\n\nexport function hashForDependencyMap(deps: DependenciesMap): string {\n  const depsList = normalizeDependencyMap(deps);\n  const depsString = depsList.join('\\n');\n  return createFileHash(depsString);\n}\n\n/**\n * Extract the template and copy the ios and android directories over to the project directory.\n *\n * @return `true` if any project files were created.\n */\nasync function cloneNativeDirectoriesAsync({\n  projectRoot,\n  tempDir,\n  exp,\n}: {\n  projectRoot: string;\n  tempDir: string;\n  exp: Pick<ExpoConfig, 'name' | 'sdkVersion'>;\n}): Promise<string[]> {\n  const templateSpec = await validateBareTemplateExistsAsync(exp.sdkVersion!);\n\n  // NOTE(brentvatne): Removing spaces between steps for now, add back when\n  // there is some additional context for steps\n  const creatingNativeProjectStep = CreateApp.logNewSection(\n    'Creating native project directories (./ios and ./android) and updating .gitignore'\n  );\n  const targetPaths = ['ios', 'android', 'index.js'];\n  let copiedPaths: string[] = [];\n  let skippedPaths: string[] = [];\n  try {\n    await Exp.extractTemplateAppAsync(templateSpec, tempDir, exp);\n    [copiedPaths, skippedPaths] = copyPathsFromTemplate(projectRoot, tempDir, targetPaths);\n    const results = GitIgnore.mergeGitIgnorePaths(\n      path.join(projectRoot, '.gitignore'),\n      path.join(tempDir, '.gitignore')\n    );\n\n    let message = `Created native projects`;\n\n    if (skippedPaths.length) {\n      message += log.chalk.dim(\n        ` | ${skippedPaths.map(path => log.chalk.bold(`/${path}`)).join(', ')} already created`\n      );\n    }\n    if (!results?.didMerge) {\n      message += log.chalk.dim(` | gitignore already synced`);\n    } else if (results.didMerge && results.didClear) {\n      message += log.chalk.dim(` | synced gitignore`);\n    }\n    creatingNativeProjectStep.succeed(message);\n  } catch (e) {\n    log(chalk.red(e.message));\n    creatingNativeProjectStep.fail(\n      'Failed to create the native project - see the output above for more information.'\n    );\n    log(\n      chalk.yellow(\n        'You may want to delete the `./ios` and/or `./android` directories before running eject again.'\n      )\n    );\n    process.exit(1);\n  }\n\n  return copiedPaths;\n}\n\n/**\n *\n * @param projectRoot\n * @param tempDir\n *\n * @return `true` if the project is ejecting, and `false` if it's syncing.\n */\nasync function createNativeProjectsFromTemplateAsync(\n  projectRoot: string,\n  exp: ExpoConfig,\n  pkg: PackageJSONConfig,\n  tempDir: string\n): Promise<\n  { hasNewProjectFiles: boolean; needsPodInstall: boolean } & DependenciesModificationResults\n> {\n  const copiedPaths = await cloneNativeDirectoriesAsync({ projectRoot, tempDir, exp });\n\n  writeMetroConfig({ projectRoot, pkg, tempDir });\n\n  const depsResults = await updatePackageJSONAsync({ projectRoot, tempDir, pkg });\n\n  return {\n    hasNewProjectFiles: !!copiedPaths.length,\n    // If the iOS folder changes or new packages are added, we should rerun pod install.\n    needsPodInstall:\n      copiedPaths.includes('ios') ||\n      depsResults.hasNewDependencies ||\n      depsResults.hasNewDevDependencies,\n    ...depsResults,\n  };\n}\n\n/**\n * Create an object of type DependenciesMap a dependencies object or throw if not valid.\n *\n * @param dependencies - ideally an object of type {[key]: string} - if not then this will error.\n */\nfunction createDependenciesMap(dependencies: any): DependenciesMap {\n  if (typeof dependencies !== 'object') {\n    throw new Error(`Dependency map is invalid, expected object but got ${typeof dependencies}`);\n  }\n\n  const outputMap: DependenciesMap = {};\n  if (!dependencies) return outputMap;\n\n  for (const key of Object.keys(dependencies)) {\n    const value = dependencies[key];\n    if (typeof value === 'string') {\n      outputMap[key] = value;\n    } else {\n      throw new Error(\n        `Dependency for key \\`${key}\\` should be a \\`string\\`, instead got: \\`{ ${key}: ${JSON.stringify(\n          value\n        )} }\\``\n      );\n    }\n  }\n  return outputMap;\n}\n\n/**\n * Some packages are not configured automatically on eject and may require\n * users to add some code, eg: to their AppDelegate.\n */\nasync function warnIfDependenciesRequireAdditionalSetupAsync(\n  pkg: PackageJSONConfig,\n  options?: EjectAsyncOptions\n): Promise<void> {\n  const pkgsWithExtraSetup: Record<string, string> = {\n    'expo-camera': 'https://github.com/expo/expo/tree/master/packages/expo-camera',\n    'expo-image-picker': 'https://github.com/expo/expo/tree/master/packages/expo-image-picker',\n    'lottie-react-native': 'https://github.com/react-native-community/lottie-react-native',\n    'expo-constants': `${chalk.bold(\n      'Constants.manifest'\n    )} is not available in the bare workflow. You should replace it with ${chalk.bold(\n      'Updates.manifest'\n    )}. ${log.chalk.dim(\n      learnMore('https://docs.expo.io/versions/latest/sdk/updates/#updatesmanifest')\n    )}`,\n  };\n  const packagesToWarn: string[] = Object.keys(pkg.dependencies).filter(\n    pkgName => pkgName in pkgsWithExtraSetup\n  );\n\n  if (packagesToWarn.length === 0) {\n    return;\n  }\n\n  log.newLine();\n  const warnAdditionalSetupStep = CreateApp.logNewSection(\n    'Checking if any additional setup steps are required for installed SDK packages.'\n  );\n\n  const plural = packagesToWarn.length > 1;\n\n  warnAdditionalSetupStep.stopAndPersist({\n    symbol: '‚ö†Ô∏è ',\n    text: chalk.red(\n      `Your app includes ${chalk.bold(`${packagesToWarn.length}`)} package${\n        plural ? 's' : ''\n      } that require${plural ? '' : 's'} additional setup in order to run:`\n    ),\n  });\n\n  packagesToWarn.forEach(pkgName => {\n    log.nested(`- ${chalk.bold(pkgName)}: ${pkgsWithExtraSetup[pkgName]}`);\n  });\n}\n\nexport function stripDashes(s: string): string {\n  return s.replace(/\\s|-/g, '');\n}\n\n/**\n * Returns true if the input string matches the default expo main field.\n *\n * - ./node_modules/expo/AppEntry\n * - ./node_modules/expo/AppEntry.js\n * - node_modules/expo/AppEntry.js\n * - expo/AppEntry.js\n * - expo/AppEntry\n *\n * @param input package.json main field\n */\nexport function isPkgMainExpoAppEntry(input?: string): boolean {\n  const main = input || '';\n  if (main.startsWith('./')) {\n    return main.includes('node_modules/expo/AppEntry');\n  }\n  return main.includes('expo/AppEntry');\n}\n"],"file":"Eject.js"}